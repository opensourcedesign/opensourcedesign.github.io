{{ define "main" }}
  {{ $eventsAll := (where site.RegularPages "Section" "events") }}
  {{ $upcomingAll := where $eventsAll "Params.status" "in" (slice "upcoming" "started") }}
  {{ $pastAll := where $eventsAll "Params.status" "in" (slice "past" "cancelled") }}
  {{ $upcoming := where $upcomingAll "File.ContentBaseName" "ne" "monthly-online-meeting" }}

  {{/* Hero Header */}}
  <section class="bg-gradient-to-b from-slate-900 to-slate-800 text-white" aria-labelledby="events-heading">
    <div class="mx-auto max-w-6xl px-4 py-16 sm:py-20">
      <div class="flex flex-col gap-8 lg:flex-row lg:items-end lg:justify-between">
        <div class="max-w-2xl">
          <div class="flex h-14 w-14 items-center justify-center rounded-xl bg-white/10 ring-1 ring-white/20">
            <svg class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"/>
            </svg>
          </div>
          <h1 id="events-heading" class="mt-6 text-3xl font-bold tracking-tight sm:text-4xl">{{ .Title }}</h1>
          {{ with .Content }}
            <div class="mt-4 text-lg text-slate-300 prose prose-invert max-w-none">{{ . }}</div>
          {{ end }}
        </div>
        <div class="flex flex-wrap gap-3">
          {{ $repo := site.Params.repoURL | default "https://github.com/opensourcedesign/opensourcedesign.github.io" }}
          <a class="inline-flex items-center gap-2 rounded-xl bg-white px-5 py-3 text-sm font-semibold text-slate-900 shadow-sm transition hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/50 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-900" href="{{ $repo }}/new/main/site/content/events" target="_blank" rel="noopener noreferrer">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
            Add Event
          </a>
          <a class="inline-flex items-center gap-2 rounded-xl border border-white/20 bg-white/10 px-5 py-3 text-sm font-semibold text-white backdrop-blur-sm transition hover:bg-white/20 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/50" href="{{ "/events/calendar.ics" | relURL }}" aria-label="Subscribe to events calendar">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"/></svg>
            iCal
          </a>
          <a class="inline-flex items-center gap-2 rounded-xl border border-white/20 bg-white/10 px-5 py-3 text-sm font-semibold text-white backdrop-blur-sm transition hover:bg-white/20 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/50" href="{{ "/events/feed.xml" | relURL }}" aria-label="Subscribe to events RSS feed">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"/></svg>
            RSS
          </a>
        </div>
      </div>
    </div>
  </section>

  {{/* Stats Bar */}}
  <section class="border-b border-slate-200 bg-white" aria-label="Event statistics">
    <div class="mx-auto max-w-6xl px-4 py-4">
      <div class="flex flex-wrap items-center justify-center gap-6 text-sm sm:justify-start">
        <div class="flex items-center gap-2">
          <span class="text-2xl font-bold text-slate-900">{{ len $upcomingAll }}</span>
          <span class="text-slate-600">upcoming</span>
        </div>
        <span class="hidden h-4 w-px bg-slate-200 sm:block" aria-hidden="true"></span>
        <div class="flex items-center gap-2">
          <span class="font-semibold text-slate-900">{{ len $pastAll }}</span>
          <span class="text-slate-600">past events</span>
        </div>
      </div>
    </div>
  </section>

  <div class="mx-auto max-w-6xl px-4 py-8">
    <div class="grid grid-cols-1 gap-8 lg:grid-cols-12">
      {{/* Main: Upcoming Events */}}
      <section class="lg:col-span-8" aria-labelledby="upcoming-heading">
        <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm sm:p-8">
          <h2 id="upcoming-heading" class="text-lg font-semibold text-slate-900">Upcoming Events</h2>
          <p class="mt-1 text-sm text-slate-500">{{ len $upcomingAll }} events scheduled</p>

          {{ if $upcoming }}
            <ul class="mt-6 space-y-4" role="list">
              {{ range $upcoming.ByDate.Reverse }}
                <li>
                  <a class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:border-slate-300 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900 focus-visible:ring-offset-2" href="{{ .RelPermalink }}" aria-label="{{ .Title }}{{ with .Params.eventDate }}, {{ . }}{{ end }}">
                    <h3 class="font-semibold text-slate-900 group-hover:text-slate-950">{{ .Title }}</h3>
                    <div class="mt-2 flex flex-wrap gap-x-4 gap-y-1 text-sm text-slate-600">
                      {{ with .Params.eventDate }}
                        <span class="inline-flex items-center gap-1.5">
                          <svg class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"/></svg>
                          <time>{{ . }}</time>
                        </span>
                      {{ end }}
                      {{ with .Params.location }}
                        <span class="inline-flex items-center gap-1.5">
                          <svg class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"/></svg>
                          <span>{{ . }}</span>
                        </span>
                      {{ end }}
                    </div>
                    {{ with .Summary }}
                      <p class="mt-3 line-clamp-2 text-sm text-slate-600">{{ . | plainify | truncate 120 }}</p>
                    {{ end }}
                  </a>
                </li>
              {{ end }}
            </ul>
          {{ else }}
            <p class="mt-6 text-sm text-slate-600">No upcoming events at the moment. Check back soon!</p>
          {{ end }}
        </div>
      </section>

      {{/* Sidebar: Monthly Meeting */}}
      <aside class="lg:col-span-4">
        {{ with site.GetPage "/events/monthly-online-meeting/" }}
          <article class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
            <div class="text-xs font-semibold uppercase tracking-wider text-slate-500">Recurring</div>
            <h2 class="mt-2 text-lg font-semibold text-slate-900">{{ .Title }}</h2>
            <dl class="mt-4 space-y-2 text-sm text-slate-700">
              {{ with .Params.eventDate }}
                <div class="flex items-center gap-2">
                  <dt class="sr-only">Date</dt>
                  <svg class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"/></svg>
                  <dd>{{ . }}</dd>
                </div>
              {{ end }}
              {{ with .Params.time }}
                <div class="flex items-center gap-2">
                  <dt class="sr-only">Time</dt>
                  <svg class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                  <dd>{{ . }}</dd>
                </div>
              {{ end }}
              {{ with .Params.location }}
                <div class="flex items-center gap-2">
                  <dt class="sr-only">Location</dt>
                  <svg class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"/></svg>
                  <dd>{{ . }}</dd>
                </div>
              {{ end }}
            </dl>
            <div class="mt-5">
              <a class="inline-flex items-center gap-2 rounded-lg bg-slate-900 px-4 py-2.5 text-sm font-semibold text-white transition hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900 focus-visible:ring-offset-2" href="{{ .RelPermalink }}">
                Learn more
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"/></svg>
              </a>
            </div>
          </article>
        {{ end }}
      </aside>
    </div>

    {{/* Past Events - Full Width Below */}}
    <section class="mt-8 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm sm:p-8" aria-labelledby="past-heading">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div>
          <h2 id="past-heading" class="text-lg font-semibold text-slate-900">Past Events</h2>
          <p class="mt-1 text-sm text-slate-500">{{ len $pastAll }} events in the archive</p>
        </div>
        <a class="inline-flex items-center gap-2 text-sm font-medium text-slate-700 underline decoration-slate-300 underline-offset-4 transition hover:text-slate-900 hover:decoration-slate-900" href="{{ "/events/archive" | relURL }}">
          Browse all
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"/></svg>
        </a>
      </div>

      <ul class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3" role="list">
        {{ range first 9 ($pastAll.ByDate.Reverse) }}
          <li>
            <a class="group block rounded-xl border border-slate-200 bg-white p-4 transition hover:border-slate-300 hover:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900" href="{{ .RelPermalink }}">
              <div class="font-medium text-slate-900 group-hover:text-slate-950">{{ .Title }}</div>
              <div class="mt-2 flex flex-wrap gap-x-3 gap-y-1 text-xs text-slate-500">
                {{ with .Params.eventDate }}
                  <span class="inline-flex items-center gap-1">
                    <svg class="h-3.5 w-3.5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"/></svg>
                    <time>{{ . }}</time>
                  </span>
                {{ end }}
                {{ with .Params.location }}
                  <span class="inline-flex items-center gap-1">
                    <svg class="h-3.5 w-3.5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"/></svg>
                    <span>{{ . }}</span>
                  </span>
                {{ end }}
              </div>
            </a>
          </li>
        {{ end }}
      </ul>
    </section>

    {{/* Footer - How to Add Events */}}
    {{ partial "section-footer.html" (dict "items" (slice
      (dict "icon" "plus" "text" "To add an event," "linkText" "fork us on GitHub" "href" (site.Params.repoURL | default "https://github.com/opensourcedesign/opensourcedesign.github.io"))
    )) }}
  </div>
{{ end }}
