{{ define "main" }}
  <div class="mx-auto max-w-6xl px-4 py-12">
    <header class="flex flex-col gap-6 sm:flex-row sm:items-end sm:justify-between">
      <div class="max-w-2xl">
        <h1 class="text-3xl font-semibold tracking-tight text-slate-950">{{ .Title }}</h1>
        {{ with .Description }}
          <p class="mt-3 text-base text-slate-700">{{ . }}</p>
        {{ end }}
        {{ with .Content }}
          <div class="osd-prose mt-6">{{ . }}</div>
        {{ end }}
      </div>
      <div class="flex flex-wrap gap-3">
        <a class="rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-800 hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900/20 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-50" href="{{ "/events/" | relURL }}">Back to events</a>
        <a class="rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-800 hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900/20 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-50" href="{{ "/events/feed.xml" | relURL }}">RSS</a>
      </div>
    </header>

    <div class="mt-8 flex flex-col gap-4 rounded-2xl border border-slate-200 bg-white p-4 shadow-sm sm:flex-row sm:items-center sm:justify-between">
      <div class="text-sm text-slate-600">
        Search past events
      </div>
      <div class="flex w-full gap-2 sm:w-auto">
        <label class="sr-only" for="events-q">Search events</label>
        <input class="w-full rounded-lg border border-slate-200 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-slate-900 sm:w-72" id="events-q" type="search" placeholder="Search eventsâ€¦" autocomplete="off" />
        <button class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-800 hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900/20 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-50" type="button" id="events-clear">Clear</button>
      </div>
    </div>

    <div class="mt-4 text-sm text-slate-600">
      <span id="events-count">0</span> results
    </div>

    {{ $eventsAll := (where site.RegularPages "Section" "events") }}
    {{ $past := where $eventsAll "Params.status" "in" (slice "past" "cancelled") }}

    <ul class="mt-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3" id="events-list">
      {{ range $past.ByDate.Reverse }}
        {{ $title := .Title | plainify | lower }}
        {{ $loc := (.Params.location | default "") | plainify | lower }}
        {{ $dateLabel := (.Params.eventDate | default "") | plainify | lower }}
        <li class="event-item" data-title="{{ $title }}" data-loc="{{ $loc }}" data-date="{{ $dateLabel }}">
          <a class="osd-card osd-card-link block h-full overflow-hidden p-5" href="{{ .RelPermalink }}">
            <div class="text-sm font-semibold text-slate-950">{{ .Title }}</div>
            <div class="mt-2 text-xs text-slate-500">
              {{ with .Params.eventDate }}
                <span class="inline-flex items-center gap-1">
                  {{ partial "icon.html" (dict "name" "calendar" "class" "h-4 w-4 text-slate-400") }}
                  <span>{{ . }}</span>
                </span>
              {{ end }}
              {{ with .Params.location }}
                <span class="inline-flex items-center gap-1">
                  {{ partial "icon.html" (dict "name" "location" "class" "h-4 w-4 text-slate-400") }}
                  <span>{{ . }}</span>
                </span>
              {{ end }}
            </div>
          </a>
        </li>
      {{ end }}
    </ul>

    <script>
      (function () {
        var list = document.getElementById('events-list');
        if (!list) return;

        var items = Array.prototype.slice.call(list.querySelectorAll('.event-item'));
        var countEl = document.getElementById('events-count');
        var input = document.getElementById('events-q');
        var clearBtn = document.getElementById('events-clear');

        function apply() {
          var q = (input && input.value ? input.value : '').trim().toLowerCase();
          var shown = 0;

          items.forEach(function (li) {
            var hay = (li.getAttribute('data-title') || '') + ' ' + (li.getAttribute('data-loc') || '') + ' ' + (li.getAttribute('data-date') || '');
            var show = !q || hay.indexOf(q) !== -1;
            li.style.display = show ? '' : 'none';
            if (show) shown++;
          });

          if (countEl) countEl.textContent = String(shown);
        }

        if (input) {
          input.addEventListener('input', apply);
        }

        if (clearBtn && input) {
          clearBtn.addEventListener('click', function () {
            input.value = '';
            apply();
            input.focus();
          });
        }

        apply();
      })();
    </script>
  </div>
{{ end }}


