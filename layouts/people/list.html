{{ define "main" }}
  {{ $people := (where site.RegularPages "Section" "people") }}
  {{ $people = sort $people "Params.name" }}
  {{ $active := where $people "Params.status" "in" (slice "core" "active") }}
  {{ $other := where (where $people "Params.status" "ne" "active") "Params.status" "ne" "core" }}

  {{/* Hero Header */}}
  <section class="bg-gradient-to-b from-slate-900 to-slate-800 text-white" aria-labelledby="people-heading">
    <div class="mx-auto max-w-6xl px-4 py-16 sm:py-20">
      <div class="flex flex-col gap-8 lg:flex-row lg:items-end lg:justify-between">
        <div class="max-w-2xl">
          <div class="flex h-14 w-14 items-center justify-center rounded-xl bg-white/10 ring-1 ring-white/20">
            <svg class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"/>
            </svg>
          </div>
          <h1 id="people-heading" class="mt-6 text-3xl font-bold tracking-tight sm:text-4xl">{{ .Title }}</h1>
          {{ with .Content }}
            <div class="mt-4 text-lg text-slate-300 prose prose-invert max-w-none prose-a:text-white prose-a:underline">{{ . }}</div>
          {{ end }}
        </div>
        <div class="flex flex-wrap gap-3">
          <a class="inline-flex items-center gap-2 rounded-xl bg-white px-5 py-3 text-sm font-semibold text-slate-900 shadow-sm transition hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/50 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-900" href="{{ "/people/join/" | relURL }}">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM3 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 019.374 21c-2.331 0-4.512-.645-6.374-1.766z"/></svg>
            Join Us
          </a>
          <a class="inline-flex items-center gap-2 rounded-xl border border-white/20 bg-white/10 px-5 py-3 text-sm font-semibold text-white backdrop-blur-sm transition hover:bg-white/20 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/50" href="{{ "/people/feed.xml" | relURL }}" aria-label="Subscribe to people RSS feed">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"/></svg>
            RSS Feed
          </a>
        </div>
      </div>
    </div>
  </section>

  {{/* Stats Bar */}}
  <section class="border-b border-slate-200 bg-white" aria-label="Community statistics">
    <div class="mx-auto max-w-6xl px-4 py-4">
      <div class="flex flex-wrap items-center justify-center gap-6 text-sm sm:justify-start">
        <div class="flex items-center gap-2">
          <span class="text-2xl font-bold text-slate-900">{{ len $people }}</span>
          <span class="text-slate-600">designers</span>
        </div>
        <span class="hidden h-4 w-px bg-slate-200 sm:block" aria-hidden="true"></span>
        <div class="flex items-center gap-2">
          <span class="h-2.5 w-2.5 rounded-full bg-emerald-500" aria-hidden="true"></span>
          <span class="font-semibold text-slate-900">{{ len $active }}</span>
          <span class="text-slate-600">active</span>
        </div>
      </div>
    </div>
  </section>

  <div class="mx-auto max-w-6xl px-4 py-8">
    {{/* Search & Filters */}}
    <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between" role="search" aria-label="Filter people">
      <div class="flex flex-wrap gap-2" role="group" aria-label="Filter by status">
        <button class="osd-filter rounded-full px-4 py-2 text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900 focus-visible:ring-offset-2" type="button" data-status="all" aria-pressed="true">All</button>
        <button class="osd-filter rounded-full px-4 py-2 text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900 focus-visible:ring-offset-2" type="button" data-status="active" aria-pressed="false">Active</button>
        <button class="osd-filter rounded-full px-4 py-2 text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900 focus-visible:ring-offset-2" type="button" data-status="other" aria-pressed="false">Other</button>
      </div>
      <div class="flex gap-2">
        <label class="sr-only" for="people-q">Search people by name or skills</label>
        <input class="w-full rounded-lg border border-slate-200 bg-white px-4 py-2.5 text-sm outline-none transition focus:border-slate-400 focus:ring-2 focus:ring-slate-900/10 sm:w-72" id="people-q" type="search" placeholder="Search by name, tagsâ€¦" autocomplete="off" />
        <button class="rounded-lg border border-slate-200 bg-white px-4 py-2.5 text-sm font-medium text-slate-600 transition hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900 focus-visible:ring-offset-2" type="button" id="people-clear" aria-label="Clear search">Clear</button>
      </div>
    </div>

    <div class="mt-4 text-sm text-slate-500" aria-live="polite" aria-atomic="true">
      <span id="people-count">{{ len $people }}</span> people
    </div>

    <p class="mt-6 hidden rounded-xl border border-slate-200 bg-white p-6 text-sm text-slate-600" id="people-empty" role="status">No people match your criteria.</p>

    {{/* Active People */}}
    {{ if $active }}
      <section aria-labelledby="people-active-title">
        <h2 class="mt-10 text-xs font-semibold uppercase tracking-widest text-slate-400" id="people-active-title">Active Contributors</h2>
        <ul class="mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3" id="people-active" role="list">
          {{ range $active }}
            {{ $name := .Params.name | default .Title }}
            {{ $status := (printf "%v" (.Params.status | default "")) | lower }}
            {{ $tags := .Params.tags | default (slice) }}
            {{ $tagsStr := "" }}
            {{ if (reflect.IsSlice $tags) }}
              {{ $tagsStr = delimit $tags "," }}
            {{ else }}
              {{ $tagsStr = printf "%v" $tags }}
            {{ end }}
            <li>
              <a class="person-item group flex h-full flex-col rounded-2xl border border-slate-200 bg-white p-5 shadow-sm transition hover:border-slate-300 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900 focus-visible:ring-offset-2" href="{{ .RelPermalink }}" data-group="active" data-status="{{ $status }}" data-name="{{ $name | plainify | lower }}" data-tags="{{ $tagsStr | plainify | lower }}" aria-label="{{ $name }}">
                <div class="flex items-start justify-between gap-3">
                  <div class="min-w-0 flex-1">
                    <div class="font-semibold text-slate-900 group-hover:text-slate-950">{{ $name }}</div>
                    {{ if and .Title (ne .Title $name) }}
                      <div class="mt-1 text-sm text-slate-600">{{ .Title | plainify }}</div>
                    {{ end }}
                  </div>
                  {{ if or (eq $status "active") (eq $status "core") }}
                    {{ partial "badge.html" (dict "text" $status "color" "emerald") }}
                  {{ end }}
                </div>

                <div class="mt-3 flex flex-wrap items-center gap-x-4 gap-y-1 text-xs text-slate-500">
                  {{ with .Params.availability }}
                    <span class="inline-flex items-center gap-1.5">
                      <svg class="h-3.5 w-3.5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      {{ . }}
                    </span>
                  {{ end }}
                  {{ with (index .Params "hourly rate") }}
                    <span class="inline-flex items-center gap-1.5">
                      <svg class="h-3.5 w-3.5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      {{ . }}
                    </span>
                  {{ else }}
                    {{ with .Params.rate }}
                      <span class="inline-flex items-center gap-1.5">
                        <svg class="h-3.5 w-3.5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        {{ . }}
                      </span>
                    {{ end }}
                  {{ end }}
                  {{ with .Params.website }}
                    <span class="inline-flex items-center gap-1.5">
                      <svg class="h-3.5 w-3.5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418"/></svg>
                      Website
                    </span>
                  {{ end }}
                </div>

                {{ with .Summary }}
                  <p class="mt-3 flex-1 line-clamp-3 text-sm leading-relaxed text-slate-600">{{ . | plainify | truncate 120 }}</p>
                {{ end }}

                {{ if $tags }}
                  <div class="mt-4 border-t border-slate-100 pt-4">
                    {{ partial "render-tags.html" (dict "tags" $tags "limit" 4) }}
                  </div>
                {{ end }}
              </a>
            </li>
          {{ end }}
        </ul>
      </section>
    {{ end }}

    {{/* Other People */}}
    {{ if $other }}
      <section aria-labelledby="people-other-title">
        <h2 class="mt-12 text-xs font-semibold uppercase tracking-widest text-slate-400" id="people-other-title">Community Members</h2>
        <ul class="mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3" id="people-other" role="list">
          {{ range $other }}
            {{ $name := .Params.name | default .Title }}
            {{ $status := (printf "%v" (.Params.status | default "")) | lower }}
            {{ $tags := .Params.tags | default (slice) }}
            {{ $tagsStr := "" }}
            {{ if (reflect.IsSlice $tags) }}
              {{ $tagsStr = delimit $tags "," }}
            {{ else }}
              {{ $tagsStr = printf "%v" $tags }}
            {{ end }}
            <li>
              <a class="person-item group flex h-full flex-col rounded-2xl border border-slate-200 bg-white p-5 shadow-sm transition hover:border-slate-300 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-900 focus-visible:ring-offset-2" href="{{ .RelPermalink }}" data-group="other" data-status="{{ $status }}" data-name="{{ $name | plainify | lower }}" data-tags="{{ $tagsStr | plainify | lower }}" aria-label="{{ $name }}">
                <div class="font-semibold text-slate-900 group-hover:text-slate-950">{{ $name }}</div>
                {{ if and .Title (ne .Title $name) }}
                  <div class="mt-1 text-sm text-slate-600">{{ .Title | plainify }}</div>
                {{ end }}
                {{ with .Summary }}
                  <p class="mt-3 flex-1 line-clamp-3 text-sm leading-relaxed text-slate-600">{{ . | plainify | truncate 120 }}</p>
                {{ end }}
              </a>
            </li>
          {{ end }}
        </ul>
      </section>
    {{ end }}

    <script>
      (function () {
        var items = Array.prototype.slice.call(document.querySelectorAll('.person-item'));
        if (!items.length) return;

        var input = document.getElementById('people-q');
        var clearBtn = document.getElementById('people-clear');
        var countEl = document.getElementById('people-count');
        var emptyEl = document.getElementById('people-empty');
        var activeTitle = document.getElementById('people-active-title');
        var otherTitle = document.getElementById('people-other-title');
        var activeWrap = document.getElementById('people-active');
        var otherWrap = document.getElementById('people-other');
        var buttons = Array.prototype.slice.call(document.querySelectorAll('.osd-filter'));

        function setPressed(activeStatus) {
          buttons.forEach(function (btn) {
            var on = btn.getAttribute('data-status') === activeStatus;
            btn.setAttribute('aria-pressed', on ? 'true' : 'false');
            if (on) {
              btn.classList.add('bg-slate-900', 'text-white');
              btn.classList.remove('bg-slate-100', 'text-slate-700');
            } else {
              btn.classList.remove('bg-slate-900', 'text-white');
              btn.classList.add('bg-slate-100', 'text-slate-700');
            }
          });
        }

        function getState() {
          var params = new URLSearchParams(window.location.search);
          return { status: params.get('status') || 'all', q: params.get('q') || '' };
        }

        function setState(next) {
          var params = new URLSearchParams(window.location.search);
          if (next.status && next.status !== 'all') params.set('status', next.status); else params.delete('status');
          if (next.q) params.set('q', next.q); else params.delete('q');
          var qs = params.toString();
          var url = window.location.pathname + (qs ? ('?' + qs) : '');
          window.history.replaceState({}, '', url);
        }

        function apply() {
          var state = getState();
          var q = (state.q || '').trim().toLowerCase();
          setPressed(state.status);
          if (input && input.value !== state.q) input.value = state.q;

          var shown = 0;
          var shownActive = 0;
          var shownOther = 0;

          items.forEach(function (a) {
            var hay = (a.getAttribute('data-name') || '') + ' ' + (a.getAttribute('data-tags') || '');
            var st = (a.getAttribute('data-status') || '').toLowerCase();
            var group = a.getAttribute('data-group') || '';
            var okQ = !q || hay.indexOf(q) !== -1;
            var okS = state.status === 'all' || (state.status === 'active' && (st === 'active' || st === 'core')) || (state.status === 'other' && !(st === 'active' || st === 'core'));
            var show = okQ && okS;
            a.parentElement.style.display = show ? '' : 'none';
            if (show) {
              shown++;
              if (group === 'active') shownActive++;
              if (group === 'other') shownOther++;
            }
          });

          if (countEl) countEl.textContent = String(shown);
          if (emptyEl) emptyEl.classList.toggle('hidden', shown !== 0);
          if (activeTitle) activeTitle.classList.toggle('hidden', shownActive === 0);
          if (otherTitle) otherTitle.classList.toggle('hidden', shownOther === 0);
          if (activeWrap) activeWrap.classList.toggle('hidden', shownActive === 0);
          if (otherWrap) otherWrap.classList.toggle('hidden', shownOther === 0);
        }

        buttons.forEach(function (btn) {
          btn.addEventListener('click', function () {
            var next = getState();
            next.status = btn.getAttribute('data-status') || 'all';
            setState(next);
            apply();
          });
        });

        if (input) input.addEventListener('input', function () { var next = getState(); next.q = input.value || ''; setState(next); apply(); });
        if (clearBtn && input) clearBtn.addEventListener('click', function () { var next = getState(); next.q = ''; setState(next); input.value = ''; apply(); input.focus(); });

        apply();
      })();
    </script>
  </div>
{{ end }}
