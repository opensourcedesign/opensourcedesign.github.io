{{ define "main" }}
  <article class="mx-auto max-w-3xl px-4 py-12">
    {{ $comp := (printf "%v" (.Params.compensation | default "")) | lower }}
    {{ $isPaid := eq $comp "paid" }}

    {{/* Guidelines Card */}}
    <div class="flex items-start gap-3 rounded-xl border border-amber-200 bg-amber-50 p-4">
      <svg class="mt-0.5 h-5 w-5 shrink-0 text-amber-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"/></svg>
      <p class="text-sm text-amber-800">When responding, avoid generic copy‑pasted responses. See the <a class="font-semibold underline underline-offset-2 hover:no-underline" href="{{ site.Params.jobGuidelinesURL | default "https://discourse.opensourcedesign.net/t/guidelines-for-responding-to-jobs/1925" }}" target="_blank" rel="noopener noreferrer">job response guidelines</a>.</p>
    </div>

    <div class="rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden mt-4">
      {{/* Header */}}
      <header class="p-6 sm:p-8">
        {{/* Title row */}}
        <div class="flex flex-wrap items-start justify-between gap-3">
          <h1 class="text-2xl font-bold tracking-tight text-slate-900">{{ .Title }}</h1>
          {{ if $comp }}
            {{ if $isPaid }}
              <span class="inline-flex shrink-0 items-center gap-1.5 rounded-full bg-emerald-100 px-3 py-1 text-sm font-semibold text-emerald-700">
                <span class="h-2 w-2 rounded-full bg-emerald-500"></span>
                Paid
              </span>
            {{ else }}
              <span class="inline-flex shrink-0 items-center gap-1.5 rounded-full bg-violet-100 px-3 py-1 text-sm font-semibold text-violet-700">
                <span class="h-2 w-2 rounded-full bg-violet-500"></span>
                Volunteer
              </span>
            {{ end }}
          {{ end }}
        </div>

        {{/* Meta info */}}
        <div class="mt-4 flex flex-wrap items-center gap-2 text-sm text-slate-500">
          {{ with .Params.organization }}
            <span class="inline-flex items-center gap-1.5 font-medium text-slate-700">
              <svg class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z"/></svg>
              {{ . }}
            </span>
            <span class="text-slate-300">·</span>
          {{ end }}
          {{ with .Params.date_posted }}
            <span class="inline-flex items-center gap-1.5">
              <svg class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"/></svg>
              Posted {{ . }}
            </span>
            <span class="text-slate-300">·</span>
          {{ end }}
          {{ with .Params.status }}
            <span class="inline-flex items-center gap-1.5 capitalize">
              <svg class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              {{ . }}
            </span>
          {{ end }}
        </div>

        {{/* Action buttons */}}
        {{ if or .Params.org_url .Params.role }}
          <div class="mt-4 flex flex-wrap items-center gap-2">
            {{ with .Params.org_url }}
              <a class="inline-flex items-center gap-1.5 rounded-lg border border-slate-200 px-3 py-1.5 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-50 hover:text-slate-900" href="{{ . }}" target="_blank" rel="noopener noreferrer">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"/></svg>
                Project Website
              </a>
            {{ end }}
            {{ with .Params.role }}
              {{ $role := replace (replace . "'" "") "'" "" }}
              {{ $role = trim $role " " }}
              {{ if $role }}
                <span class="inline-flex items-center gap-1.5 rounded-lg border border-slate-200 px-3 py-1.5 text-sm text-slate-600">
                  <svg class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/></svg>
                  {{ $role }}
                </span>
              {{ end }}
            {{ end }}
          </div>
        {{ end }}
      </header>

      {{/* Content */}}
      <div class="border-t border-slate-100 p-6 sm:p-8 space-y-8">
        {{/* Description */}}
        {{ with .Content }}
          <div class="prose prose-slate max-w-none prose-headings:font-semibold prose-a:text-slate-900 prose-a:underline prose-a:decoration-slate-300 prose-a:underline-offset-4 hover:prose-a:decoration-slate-600">
            {{ . }}
          </div>
        {{ end }}

        {{/* Deliverables */}}
        {{ with .Params.deliverables }}
          {{ $val := printf "%v" . }}
          {{ $val = replace $val "\r\n" "\n" }}
          {{ $val = replace $val "\r" "\n" }}
          <div class="rounded-xl border border-slate-200 bg-slate-50 p-5">
            <h2 class="flex items-center gap-2 text-sm font-semibold text-slate-900">
              <svg class="h-5 w-5 text-slate-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z"/></svg>
              Deliverables
            </h2>
            <ul class="mt-3 list-disc pl-5 space-y-1 text-sm text-slate-700">
              {{ range split $val "\n" }}
                {{ $line := trim . " -•" }}
                {{ if $line }}
                  <li>{{ $line }}</li>
                {{ end }}
              {{ end }}
            </ul>
          </div>
        {{ end }}

        {{/* How to Apply */}}
        {{ with .Params.how_to_apply }}
          <div class="rounded-xl bg-slate-900 p-6">
            <h2 class="flex items-center gap-2 font-semibold text-white">
              <svg class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"/></svg>
              How to Apply
            </h2>
            <ul class="mt-4 space-y-3 text-sm text-slate-300">
              {{ if (reflect.IsSlice .) }}
                {{ range . }}
                  {{ $item := printf "%v" . }}
                  {{ $item = replace $item "\r\n" "\n" }}
                  {{ $item = replace $item "\r" "\n" }}
                  {{ $lines := split $item "\n" }}
                  {{ range $lines }}
                    {{ $line := trim . " " }}
                    {{ if $line }}
                      <li class="flex items-start gap-3">
                        <svg class="mt-0.5 h-4 w-4 shrink-0 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/></svg>
                        <span class="break-all">{{ partial "linkify" (dict "text" $line) }}</span>
                      </li>
                    {{ end }}
                  {{ end }}
                {{ end }}
              {{ else }}
                {{ $text := printf "%v" . }}
                {{ $text = replace $text "\r\n" "\n" }}
                {{ $text = replace $text "\r" "\n" }}
                {{ range split $text "\n" }}
                  {{ $line := trim . " " }}
                  {{ if $line }}
                    <li class="flex items-start gap-3">
                      <svg class="mt-0.5 h-4 w-4 shrink-0 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/></svg>
                      <span class="break-all">{{ partial "linkify" (dict "text" $line) }}</span>
                    </li>
                  {{ end }}
                {{ end }}
              {{ end }}
            </ul>
          </div>
        {{ end }}

        {{/* Links */}}
        {{ with .Params.links }}
          <div>
            <h2 class="flex items-center gap-2 text-xs font-semibold uppercase tracking-wider text-slate-500">
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"/></svg>
              Related Links
            </h2>
            <ul class="mt-3 space-y-2 text-sm text-slate-700">
              {{ if (reflect.IsSlice .) }}
                {{ range . }}
                  <li class="break-all">{{ partial "linkify" (dict "text" (printf "%v" .)) }}</li>
                {{ end }}
              {{ else }}
                {{ $text := printf "%v" . }}
                {{ $text = replace $text "\r\n" "\n" }}
                {{ $text = replace $text "\r" "\n" }}
                {{ range split $text "\n" }}
                  {{ $line := trim . " " }}
                  {{ if $line }}
                    <li class="break-all">{{ partial "linkify" (dict "text" $line) }}</li>
                  {{ end }}
                {{ end }}
              {{ end }}
            </ul>
          </div>
        {{ end }}

        {{/* Tags */}}
        {{ with .Params.tags }}
          <div>
            <h2 class="flex items-center gap-2 text-xs font-semibold uppercase tracking-wider text-slate-500">
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"/><path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z"/></svg>
              Tags
            </h2>
            <div class="mt-3 flex flex-wrap gap-2">
              {{ if (reflect.IsSlice .) }}
                {{ range . }}
                  <span class="rounded-full bg-slate-100 px-3 py-1 text-xs font-medium text-slate-600">{{ . }}</span>
                {{ end }}
              {{ else }}
                {{ range (split (printf "%v" .) ",") }}
                  {{ $t := trim . " " }}
                  {{ if $t }}<span class="rounded-full bg-slate-100 px-3 py-1 text-xs font-medium text-slate-600">{{ $t }}</span>{{ end }}
                {{ end }}
              {{ end }}
            </div>
          </div>
        {{ end }}
      </div>

      {{/* Similar Jobs */}}
      <div class="border-t border-slate-100 p-6 sm:px-8">
        {{ partial "similar-jobs.html" . }}
      </div>

      {{/* Share Buttons */}}
      <div class="border-t border-slate-100 p-6 sm:px-8">
        {{ partial "share.html" . }}
      </div>

      {{/* Footer */}}
      <footer class="flex flex-wrap items-center gap-3 border-t border-slate-100 p-6 sm:px-8">
        <a class="inline-flex items-center gap-2 rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800" href="{{ "/jobs/" | relURL }}">
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"/></svg>
          Back to jobs
        </a>
      </footer>
    </div>
  </article>
{{ end }}
